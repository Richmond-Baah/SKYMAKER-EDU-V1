"use strict";(()=>{var e={};e.id=914,e.ids=[914],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},42527:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>g,originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>b});var r={};s.r(r),s.d(r,{GET:()=>c,POST:()=>u});var i=s(95419),n=s(69108),o=s(99678),a=s(78070),d=s(81664);async function u(e,{params:t}){let s=(0,d.f)(),r=t&&t.code||"",i=e.headers.get("x-student-id")||`anon-${Date.now()}-${Math.random()}`;try{let{data:t}=await s.auth.getUser(),n=t?.user?.id||null,o=await e.json(),d=o.missionId||"",u=o.code||"",c=o.flightData||null;if(!d||!u)return a.Z.json({error:"missionId and code required"},{status:400});let{data:l,error:m}=await s.from("assignments").select("*").eq("code",r).single();if(m||!l)return a.Z.json({error:"Assignment not found"},{status:404});if(!l.missions.includes(d))return a.Z.json({error:"Mission not in this assignment"},{status:400});let f=function(e,t,s,r){let i=[],n=0,o={};if(r?.landed&&(s.landed?(n+=30,o.landed=30):(i.push("Drone did not land as required."),o.landed=0)),r?.minAltitude!==void 0&&((s.maxAltitude||0)>=r.minAltitude?(n+=20,o.altitude=20):(i.push(`Reach at least ${r.minAltitude}m altitude.`),o.altitude=0)),r?.maxTime!==void 0&&void 0!==s.time&&(s.time<=r.maxTime?(n+=15,o.time=15):(i.push(`Try to complete the mission faster (target ${r.maxTime}s).`),o.time=0)),r?.positionAccuracy!==void 0&&s.path&&s.path.length>0){let e=s.path[s.path.length-1],t=Math.sqrt(e.x*e.x+e.y*e.y);t<=(r.positionAccuracy||0)?(n+=20,o.accuracy=20):(i.push(`Final position off by ${t.toFixed(2)}m (allowed ${r.positionAccuracy}m).`),o.accuracy=Math.max(0,20-Math.min(20,Math.round(t/(r.positionAccuracy||1)*20))))}let a=/for\s*\(|for\s+\w+|while\s*\(/.test(t),d=/\bdef\b|\bvar\b|\breturn\b|\b=\b/.test(t);a?(n+=10,o.loops=10):o.loops=0,d?(n+=5,o.code=5):o.code=0;let u=(n=Math.min(100,n))>=70;return u?i.unshift("Mission passed â€” well done!"):i.unshift("Mission did not meet pass criteria. See hints."),{score:n,passed:u,feedback:i,breakdown:o}}(0,u,c),p=Array.isArray(f.feedback)?f.feedback.join(" "):f.feedback,{data:g,error:b}=await s.from("submissions").insert({assignment_id:l.id,user_id:n,student_id:i,mission_id:d,code:u,flight_data:c}).select().single();if(b)throw b;let{data:h,error:y}=await s.from("grades").insert({submission_id:g.id,score:f.score,passed:f.passed,feedback:p,breakdown:f.breakdown||{}}).select().single();if(y)throw y;return a.Z.json({submission:{id:g.id,studentId:g.student_id,missionId:g.mission_id,createdAt:g.created_at},grade:{score:h.score,passed:h.passed,feedback:h.feedback,breakdown:h.breakdown}},{status:201})}catch(e){return console.error("Submission error:",e),a.Z.json({error:"Invalid request"},{status:400})}}async function c(e,{params:t}){let s=(0,d.f)(),r=t&&t.code||"",{data:i,error:n}=await s.from("assignments").select(`
      *,
      submissions (
        *,
        grades (*)
      )
    `).eq("code",r).single();if(n||!i)return a.Z.json({error:"Assignment not found"},{status:404});let o=Array.from(new Set(i.submissions.map(e=>e.user_id).filter(e=>null!==e))),u={};if(o.length>0){let{data:e}=await s.from("profiles").select("id, full_name, username").in("id",o);if(e)for(let t of e)u[t.id]=t.full_name||t.username||`Student ${t.id.slice(0,8)}`}return a.Z.json({code:i.code,title:i.title,missions:i.missions,submissions:i.submissions.map(e=>({id:e.id,studentId:e.student_id,userId:e.user_id,studentName:e.user_id?u[e.user_id]||`Student ${e.student_id.slice(0,8)}`:`Anonymous ${e.student_id.slice(0,8)}`,missionId:e.mission_id,code:e.code,createdAt:e.created_at,grade:e.grades&&e.grades.length>0?{score:e.grades[0].score,passed:e.grades[0].passed,feedback:e.grades[0].feedback,breakdown:e.grades[0].breakdown}:null}))})}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/submissions/[code]/route",pathname:"/api/submissions/[code]",filename:"route",bundlePath:"app/api/submissions/[code]/route"},resolvedPagePath:"C:\\Users\\3FARMATE ROBOTICS\\Downloads\\ESP-Drone-main\\ESP-Drone-main\\Firmware\\esp-drone\\drone-programming-platform\\app\\api\\submissions\\[code]\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:p,headerHooks:g,staticGenerationBailout:b}=l,h="/api/submissions/[code]/route";function y(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:f})}},81664:(e,t,s)=>{s.d(t,{f:()=>n});var r=s(16496),i=s(7439);function n(){let e=(0,i.cookies)(),t="https://ntmginemkxkurawsabdi.supabase.co",s="sb_publishable_RI5bB73WNkwcTpfaRR5Zlw_0rZxPXuW";if(!t||!s)throw Error("Supabase URL or Anon Key is missing in server context.");return(0,r.createServerClient)(t,s,{cookies:{get:t=>e.get(t)?.value,set(t,s,r){try{e.set({name:t,value:s,...r})}catch(e){}},remove(t,s){try{e.set({name:t,value:"",...s})}catch(e){}}}})}},48096:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{DynamicServerError:function(){return r},isDynamicServerError:function(){return i}});let s="DYNAMIC_SERVER_USAGE";class r extends Error{constructor(e){super("Dynamic server usage: "+e),this.description=e,this.digest=s}}function i(e){return"object"==typeof e&&null!==e&&"digest"in e&&"string"==typeof e.digest&&e.digest===s}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},72973:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{isStaticGenBailoutError:function(){return a},staticGenerationBailout:function(){return u}});let r=s(48096),i=s(45869),n="NEXT_STATIC_GEN_BAILOUT";class o extends Error{constructor(...e){super(...e),this.code=n}}function a(e){return"object"==typeof e&&null!==e&&"code"in e&&e.code===n}function d(e,t){let{dynamic:s,link:r}=t||{};return"Page"+(s?' with `dynamic = "'+s+'"`':"")+" couldn't be rendered statically because it used `"+e+"`."+(r?" See more info here: "+r:"")}let u=(e,t)=>{let{dynamic:s,link:n}=void 0===t?{}:t,a=i.staticGenerationAsyncStorage.getStore();if(!a)return!1;if(a.forceStatic)return!0;if(a.dynamicShouldError)throw new o(d(e,{link:n,dynamic:null!=s?s:"error"}));let u=d(e,{dynamic:s,link:"https://nextjs.org/docs/messages/dynamic-server-error"});if(null==a.postpone||a.postpone.call(a,e),a.revalidate=0,a.isStaticGeneration){let t=new r.DynamicServerError(u);throw a.dynamicUsageDescription=e,a.dynamicUsageStack=t.stack,t}return!1};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,320,206],()=>s(42527));module.exports=r})();